version: 2.0.{build}
image:
  - Visual Studio 2015
environment:
  matrix:
    - solution_name: win32/sdlpal.sln
      APPX_OPTIONS:
    - solution_name: winrt/SDLPal.UWP.sln
      APPX_OPTIONS:  /p:AppxBundle=Always;AppxBundlePlatforms="x86|x64|ARM";AppxPackageDir="AppPackages"
    - solution_name: winrt/SDLPal.Windows.sln
      APPX_OPTIONS:  /p:AppxBundle=Always;AppxBundlePlatforms="x86|x64|ARM";AppxPackageDir="AppPackages"
    - solution_name: winrt/SDLPal.WindowsPhone.sln
      APPX_OPTIONS:  /p:AppxBundle=Always;AppxBundlePlatforms="ARM";AppxPackageDir="AppPackages"
build_script:
  - |-
    if "%APPVEYOR_REPO_TAG%" == "false" ( set APPX_OPTIONS= )
    msbuild /nologo /m %solution_name% /p:Configuration=Release %APPX_OPTIONS%
before_build:
  - |-
    git submodule update --init --recursive
after_build:
  - |-
    if "%APPVEYOR_REPO_TAG%" == "true" ( for /d %%d in ("%APPVEYOR_BUILD_FOLDER%\winrt\SDLPal.*") do ( for /d %%c in ("%%d\AppPackages\*") do ( ren "%%c" SDLPal ) ) )

deploy:
- provider: GitHub
  on:
    appveyor_repo_tag: true
  auth_token:
    secure: RYDRqm5LncsJG32FRSlCkLzkJC4ykCtlgO3+xW4q80wQOA3U9pHAe2beyMEduJIe

artifacts:
  - path: win32/Win32/Release/sdlpal.exe
    name: sdlpal-win32
    type: zip
  - path: winrt/SDLPal.UWP/AppPackages/SDLPal
    name: sdlpal-uwp
    type: zip
  - path: winrt/SDLPal.Windows/AppPackages/SDLPal
    name: sdlpal-ws81
    type: zip
  - path: winrt/SDLPal.WindowsPhone/AppPackages/SDLPal
    name: sdlpal-wp81
    type: zip

notifications:
- provider: Webhook
  url: https://webhooks.gitter.im/e/2accb0e6e37119e604b3
  method: POST
  on_build_success: true
  on_build_failure: true
  on_build_status_changed: true
